#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "grumlin"

require "irb"
require "irb/completion"

Grumlin.configure do |config|
  config.url = ENV["GREMLIN_URL"] || "ws://localhost:8182/gremlin"
end

class Repository
  extend Grumlin::Repository

  def start
    IRB.setup(binding.source_location[0], argv: [])
    workspace = IRB::WorkSpace.new(binding)

    IRB::Irb.new(workspace).run(IRB.conf)
  end
end

Async do
  Repository.new.start
ensure
  Grumlin.close
end
